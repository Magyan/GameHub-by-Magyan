<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jeu 1 - R√©action Ultime</title>
<style>
body { background:#0f1724; color:white; font-family:Arial; text-align:center; }
button { padding:10px 20px; margin:10px; border-radius:8px; border:0; cursor:pointer; font-weight:bold; }
#start { background:#00ff66; }
#back { background:#ff8c00; }
#target { 
    width:80px; 
    height:80px; 
    background:red; 
    border-radius:50%;
    position:absolute; 
    display:none; 
    cursor:pointer; 
    transition: transform 0.1s ease-out, background 0.5s ease;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
    transform: scale(1);
}
#gameArea { 
    position:relative; 
    width:90%; 
    max-width: 600px; 
    height:400px; 
    background:#111; 
    margin:20px auto; 
    border-radius:10px; 
    border: 2px solid #333;
    cursor: crosshair; 
}
#instructions {
    max-width: 600px;
    margin: 10px auto;
    padding: 15px;
    background: #0d141e;
    border-radius: 8px;
    text-align: left;
    font-size: 14px;
    color: #9aa0a6;
}
#instructions strong { color: white; }
#statusDisplay {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 15px;
}
.life-icon {
    color: red;
    font-size: 24px;
    transition: opacity 0.3s;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase_config.js"></script>
<script src="online_functions.js"></script>
</head>
<body>

<h1>Jeu 1 ‚Äî R√©action Ultime</h1>

<button id="start">D√©marrer</button>
<button id="back" onclick="location.href='index.html'">Retour</button>

<div id="instructions">
    <h3>Mode d'emploi :</h3>
    <ul>
        <li><strong>Objectif :</strong> Cliquez sur le cercle le plus rapidement possible.</li>
        <li><strong>D√©fi :</strong> La cible devient plus petite et le temps limite diminue √† chaque point.</li>
        <li><strong>Attention :</strong> La cible change de couleur (**Vert** vers **Rouge**).</li>
        <li><strong>P√©nalit√©s :</strong> Vous avez <strong id="initialLives">3</strong> vies. **Cliquer √† c√¥t√©** ou **d√©passer le temps** fait perdre une vie !</li>
    </ul>
</div>

<div id="gameArea">
  <div id="target"></div>
</div>

<div id="statusDisplay">
    <h2>Score : <span id="score">0</span></h2>
    <h2>Vies : <span id="livesContainer"></span></h2>
    <h2>Pr√©cision : <span id="accuracy">--</span>%</h2>
</div>

<script>
// --- Constantes de Jeu ---
const INITIAL_TARGET_SIZE = 80;
const MIN_TARGET_SIZE = 30;
const INITIAL_MAX_TIME = 2000; // ms
const MIN_TIME_LIMIT = 500; // ms
const TIME_DECREASE_PER_POINT = 20; // ms
const SIZE_DECREASE_PER_POINT = 1.5; // px
const MAX_MISSES = 3; // Vies

// --- Variables d'√âtat ---
let score = 0;
let lives = MAX_MISSES;
let hits = 0;
let misses = 0;
let active = false;
let targetTimeout; 
let difficultyInterval; 
let maxReactionTime = INITIAL_MAX_TIME;
let currentTargetSize = INITIAL_TARGET_SIZE;

// --- DOM Elements ---
const area = document.getElementById("gameArea");
const target = document.getElementById("target");
const scoreDisplay = document.getElementById("score");
const livesContainer = document.getElementById("livesContainer");
const accuracyDisplay = document.getElementById("accuracy");

// --- Listeners ---
document.getElementById("start").onclick = startGame;
target.onclick = hitTarget;
area.addEventListener('click', missTarget); 

// --- Logique du D√©marrage ---
function startGame(){
    if (targetTimeout) clearTimeout(targetTimeout);
    if (difficultyInterval) clearInterval(difficultyInterval);
    
    score = 0;
    lives = MAX_MISSES;
    hits = 0;
    misses = 0;
    active = true;
    maxReactionTime = INITIAL_MAX_TIME;
    currentTargetSize = INITIAL_TARGET_SIZE;

    target.style.background = 'green';
    target.style.transform = 'scale(1)';
    target.style.width = `${currentTargetSize}px`;
    target.style.height = `${currentTargetSize}px`;

    updateGameStats();
    moveTarget();
}

// --- Mise √† Jour des Statistiques (Centralis√©e) ---
function updateGameStats() {
    scoreDisplay.textContent = score;
    
    livesContainer.innerHTML = '';
    for(let i = 0; i < MAX_MISSES; i++) {
        const span = document.createElement('span');
        span.classList.add('life-icon');
        span.innerHTML = '‚ù§Ô∏è';
        if (i >= lives) {
            span.style.opacity = '0.3';
        }
        livesContainer.appendChild(span);
    }

    const totalAttempts = hits + misses;
    if (totalAttempts > 0) {
        const accuracy = Math.round((hits / totalAttempts) * 100);
        accuracyDisplay.textContent = accuracy;
    } else {
        accuracyDisplay.textContent = '--';
    }
}

// --- Gestion des Cibles (Mouvement et Temps) ---
function moveTarget(){
    if(!active) return;
    
    if (targetTimeout) clearTimeout(targetTimeout);
    if (difficultyInterval) clearInterval(difficultyInterval);
    
    const timeLimit = Math.max(MIN_TIME_LIMIT, INITIAL_MAX_TIME - (score * TIME_DECREASE_PER_POINT));
    currentTargetSize = Math.max(MIN_TARGET_SIZE, INITIAL_TARGET_SIZE - (score * SIZE_DECREASE_PER_POINT));
    
    target.style.width = `${currentTargetSize}px`;
    target.style.height = `${currentTargetSize}px`;

    targetTimeout = setTimeout(() => {
        loseLife("Temps √©coul√©");
        moveTarget(); 
    }, timeLimit);

    target.style.background = 'lime'; 
    let colorStep = 0;
    
    difficultyInterval = setInterval(() => {
        if (!active) return clearInterval(difficultyInterval);
        colorStep += 1;
        
        const greenValue = 255 - Math.min(255, Math.floor(255 * (colorStep / (timeLimit / 10))));
        const redValue = Math.min(255, Math.floor(255 * (colorStep / (timeLimit / 10))));
        target.style.background = `rgb(${redValue}, ${greenValue}, 0)`;

        if (colorStep * 10 >= timeLimit) {
             clearInterval(difficultyInterval);
        }
    }, timeLimit / 10);


    const areaWidth = area.clientWidth;
    const areaHeight = area.clientHeight;
    
    const x = Math.random() * (areaWidth - currentTargetSize);
    const y = Math.random() * (areaHeight - currentTargetSize);

    target.style.left = x + "px";
    target.style.top = y + "px";
    target.style.display = "block";
    
    target.style.transform = 'scale(0.8)';
    setTimeout(() => { target.style.transform = 'scale(1)'; }, 10);
}

// --- Gestion des Actions du Joueur ---
function hitTarget(event){
    if(!active) return;
    
    event.stopPropagation(); 
    
    if (targetTimeout) clearTimeout(targetTimeout);
    if (difficultyInterval) clearInterval(difficultyInterval);
    
    score++;
    hits++;
    
    updateGameStats();
    moveTarget();
}

function missTarget(event){
    if(!active) return;
    if (event.target.id === 'gameArea') {
        loseLife("Cible manqu√©e (clic √† c√¥t√©)");
        
        if (targetTimeout) clearTimeout(targetTimeout);
        if (difficultyInterval) clearInterval(difficultyInterval);
        moveTarget(); 
    }
}

function loseLife(reason) {
    if (!active) return;
    lives--;
    misses++;
    
    target.style.background = 'red'; 
    
    if (lives <= 0) {
        gameOver(`Perdu : ${reason} !`);
    } else {
        console.log(`Vie perdue: ${reason}. Vies restantes: ${lives}`);
    }
    updateGameStats();
}


// --- Fin de Jeu ---
function gameOver(message){
    active = false;
    target.style.display = "none";
    
    if (targetTimeout) clearTimeout(targetTimeout);
    if (difficultyInterval) clearInterval(difficultyInterval);
    
    // üì¢ SAUVEGARDE EN LIGNE
    saveScore(score, "Jeu 1 ‚Äî R√©action");
    
    alert(`${message} Score final : ${score}. Pr√©cision : ${accuracyDisplay.textContent}%`);
}


// Initialisation de l'affichage des vies au chargement
document.addEventListener('DOMContentLoaded', () => {
    updateGameStats(); 
});
</script>
</body>
</html>
